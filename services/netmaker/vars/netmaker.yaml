---
# Netmaker variables

# Base variables
netmaker_base_domain: "netmaker.stechsolutions.ca"
netmaker_ee: true
# Separate flag for the ee_image. So I can run the prometheus, grafana,
# and netmaker-exporter containers without actually using the EE image or
# license.
netmaker_ee_use_ee_image: true
netmaker_version: "v0.20.6"
netmaker_directory: "/home/{{ default_user }}/netmaker"
netclient_directory: "/home/{{ default_user }}/netclient"

# TURN variables
netmaker_turn_username: "netmaker"

# Mosquitto variables
netmaker_mq_config_url:
  "https://raw.githubusercontent.com/gravitl/netmaker/\
  {{ netmaker_version }}\
  /docker/mosquitto.conf"
netmaker_mq_username: "netmaker"

# Wait script
netmaker_wait_script_url:
  "https://raw.githubusercontent.com/gravitl/netmaker/\
  {{ netmaker_version }}\
  /docker/wait.sh"

# Netmaker Volume on DigitalOcean
# state: present | absent
netmaker_volume:
  {volume_name: 'netmaker-data', state: 'present', block_size: 5}

# Netmaker Droplet
# state: present | absent
netmaker_droplet:
  {name: 'netmaker01',
   state: 'present',
   tags: ['Netmaker', "VPN", "HTTPS"],
   volume: {volume_name: '{{ netmaker_volume.volume_name }}',
            state: 'present',
            mount_point: '/home/{{ default_user }}/docker',
            group: 'root',
            owner: 'root',
            become_to_mount: true
   }
  }

# Netmaker Cloudflare DNS Record for root, dashboard, api, and broker
# subdomains.
netmaker_cf_record:
  - {
    name: 'netmaker01',
    zone: 'stechsolutions.ca',
    record: 'netmaker',
    proxied: false,
    state: '{{ netmaker_droplet.state }}',
  }
  - {
    name: 'netmaker01',
    zone: 'stechsolutions.ca',
    record: 'dashboard.netmaker',
    proxied: false,
    state: '{{ netmaker_droplet.state }}'
  }
  - {
    name: 'netmaker01',
    zone: 'stechsolutions.ca',
    record: 'api.netmaker',
    proxied: false,
    state: '{{ netmaker_droplet.state }}'
  }
  - {
    name: 'netmaker01',
    zone: 'stechsolutions.ca',
    record: 'broker.netmaker',
    proxied: false,
    state: '{{ netmaker_droplet.state }}'
  }
  - {
    name: 'netmaker01',
    zone: 'stechsolutions.ca',
    record: 'stun.netmaker',
    proxied: false,
    state: '{{ netmaker_droplet.state }}'
  }
  - {
    name: 'netmaker01',
    zone: 'stechsolutions.ca',
    record: 'turn.netmaker',
    proxied: false,
    state: '{{ netmaker_droplet.state }}'
  }
  - {
    name: 'netmaker01',
    zone: 'stechsolutions.ca',
    record: 'turnapi.netmaker',
    proxied: false,
    state: '{{ netmaker_droplet.state }}'
  }
  # Netmaker Cloudflare DNS Record for grafana, prometheus,
  # and netmaker-exporter subdomains for the EE setup.
  - {
    name: 'netmaker01',
    zone: 'stechsolutions.ca',
    record: 'grafana.netmaker',
    proxied: false,
    state: '{{ netmaker_droplet.state if netmaker_ee else "absent" }}',
  }
  - {
    name: 'netmaker01',
    zone: 'stechsolutions.ca',
    record: 'prometheus.netmaker',
    proxied: false,
    state: '{{ netmaker_droplet.state if netmaker_ee else "absent" }}'
  }
  - {
    name: 'netmaker01',
    zone: 'stechsolutions.ca',
    record: 'netmaker-exporter.netmaker',
    proxied: false,
    state: '{{ netmaker_droplet.state if netmaker_ee else "absent" }}'
  }

# nmctl variables
netmaker_nmctl_context_name: "production"
netmaker_nmctl_endpoint: "https://api.{{ netmaker_base_domain }}"

# netmaker networks and enrollment keys
# It is a one to one mapping of networks and enrollment keys
# so they are defined in the same list.
# The tags needs to be unique.
netmaker_networks:
  - {
    name: 'monitoring',
    addressrange: "10.50.50.0/24",
    addressrange6: "",
    isipv4: "yes",
    isipv6: "no",
    tags: "monitoring-tag",
    enrollment_unlimited: true,
  }
  - {
    name: 'personal',
    addressrange: "10.50.60.0/24",
    addressrange6: "",
    isipv4: "yes",
    isipv6: "no",
    tags: "personal-tag",
    enrollment_unlimited: true,
  }
  - {
    name: 'farm-network',
    addressrange: "10.50.70.0/24",
    addressrange6: "",
    isipv4: "yes",
    isipv6: "no",
    tags: "farm-network-tag",
    enrollment_unlimited: true,
  }

# netmaker host and node definitions
netmaker_host_settings: {
  name: '{{ netmaker_droplet.name }}',
  isdefault: true,
  node_settings: [
    {
      # monitoring network
      network: '{{ netmaker_networks[0].name }}',
      isegressgateway: false,
      isingressgateway: true,
      egressgatewayranges: [],
      egressgatewaynatenabled: false,
      ingressdns: "1.1.1.1",
    },
    {
      # personal network
      network: '{{ netmaker_networks[1].name }}',
      isegressgateway: false,
      isingressgateway: true,
      egressgatewayranges: [],
      egressgatewaynatenabled: false,
      ingressdns: "1.1.1.1",
    },
    {
      # farm-network network
      network: '{{ netmaker_networks[2].name }}',
      isegressgateway: false,
      isingressgateway: true,
      egressgatewayranges: [],
      egressgatewaynatenabled: false,
      ingressdns: "1.1.1.1",
    }
  ]
}

# netmaker external client definitions
# The name must be alphanumeric or hyphens and less than 15 chars
#
# When the external client configuration is exported, the name of the
# configuration file is {{ item.name }}-{{ item.network }}-netmaker-client.conf
netmaker_ext_clients:
  - {
    name: 'iPhone-monitoring',
    host: '{{ netmaker_host_settings.name }}',
    # monitoring network
    network: '{{ netmaker_networks[0].name }}',
    allowedips: "",
    dns: "",
  }
  - {
    name: 'iPhone-personal',
    host: '{{ netmaker_host_settings.name }}',
    # personal network
    network: '{{ netmaker_networks[1].name }}',
    allowedips: "",
    dns: "10.10.1.11",
  }
  - {
    name: 'iPhone-farm-network',
    host: '{{ netmaker_host_settings.name }}',
    # farm-network network
    network: '{{ netmaker_networks[2].name }}',
    allowedips: "",
    dns: "",
  }
